The Nautilus DevOps team want to install and set up a simple httpd web server on all app servers in Stratos DC. They also want to deploy a sample web page using Ansible only. Therefore, prepare the required playbook to complete this task. Find more details about the task below.

We already have an inventory file under /home/thor/ansible on jump host. Create a playbook.yml under /home/thor/ansible on jump host itself.

Using the playbook install httpd web server on all app servers, and make sure its service is up and running.

Create a file /var/www/html/index.html with content:

This is a Nautilus sample file, created using Ansible!

Using lineinfile Ansible module add some more content in /var/www/html/index.html file. Below is the content:
Welcome to xFusionCorp Industries!

Also make sure this new line is added at the top of the file.

The /var/www/html/index.html file's user and group owner should be apache on all app servers.

The /var/www/html/index.html file's permissions should be 0644 on all app servers.

Note: Validation will try to run playbook using command ansible-playbook -i inventory playbook.yml so please make sure playbook works this way, without passing any extra arguments.


Solution:

vi playbook.yaml

- name: Install and configure web server
    hosts: all
    become: yes
    become_user: root
    tasks:
      - name: Install httpd package on all application servers
        yum:
          name: httpd
          state: installed

      - name: Start httpd service
        service:
          name: httpd
          state: started
          enabled: true

      - name: Create blank file and add contents to it
        copy:
          dest: "/var/www/html/index.html"
          content: |
            This is a Nautilus sample file, created using Ansible!

      - name: Adding more info to index.html file
        lineinfile:
          path: /var/www/html/index.html
          line: 'Welcome to xFusionCorp Industries!'
          insertbefore: BOF

      - name: Change file ownership, group and permissions
        file:
          path: /var/www/html/index.html
          owner: apache
          group: apache
          mode: '0655'
          
   ansible-playbook -i /home/thore/ansible/inventery playbook.yaml
   
   Task completed.
